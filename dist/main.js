(()=>{const t=document.querySelector("#flip-button"),e=document.querySelector(".option-container"),n=document.querySelector("#gamesboard-container"),o=document.querySelector("#start-button"),r=document.querySelector("#info"),s=document.querySelector("#turn-display");let c=0;t.addEventListener("click",(function(){const t=Array.from(e.children);c=0===c?90:0,t.forEach((t=>t.style.transform=`rotate(${c}deg)`))}));const a=10;function l(t,e){const o=document.createElement("div");o.classList.add("game-board"),o.style.backgroundColor=t,o.id=e;for(let t=0;t<a*a;t++){const e=document.createElement("div");e.classList.add("block"),e.id=t,o.append(e)}n.append(o)}l("yellow","player"),l("pink","computer");class i{constructor(t,e){this.name=t,this.length=e}}const u=[new i("destroyer",2),new i("submarine",3),new i("cruiser",3),new i("battleship",4),new i("carrier",5)];let d,m;function h(t,e,n,o){let r,s=e?n<=a*a-o.length?n:a*a-o.length:n<=a*a-a*o.length?n:n-o.length*a+a,c=[];for(let n=0;n<o.length;n++)e?c.push(t[Number(s)+n]):c.push(t[Number(s)+n*a]);e?c.every(((t,e)=>r=c[0].id%a!=a-(c.length-(e+1)))):c.every(((t,e)=>r=c[0].id<a*e+1+90));const l=c.every((t=>!t.classList.contains("taken")));return{shipBlocks:c,valid:r,notTaken:l}}function p(t,e,n){const o=document.querySelectorAll(`#${t} div`);let r=Math.random()<.5,s="player"===t?0===c:r,l=Math.floor(Math.random()*a*a),i=n||l;const{shipBlocks:u,valid:m,notTaken:f}=h(o,s,i,e);m&&f?u.forEach((t=>{t.classList.add(e.name),t.classList.add("taken")})):("computer"===t&&p(t,e,n),"player"===t&&(d=!0))}function f(t){d=!1,m=t.target}function y(t){t.preventDefault();const e=u[m.id];!function(t,e){const n=document.querySelectorAll("#player div");let o=0===c;const{shipBlocks:r,valid:s,notTaken:a}=h(n,o,t,e);s&&a&&r.forEach((t=>{t.classList.add("hover"),setTimeout((()=>t.classList.remove("hover")),500)}))}(t.target.id,e)}function g(t){const e=t.target.id;p("player",u[m.id],e),d||m.remove()}u.forEach((t=>p("computer",t))),Array.from(e.children).forEach((t=>t.addEventListener("dragstart",f))),document.querySelectorAll("#player div").forEach((t=>{t.addEventListener("dragover",y),t.addEventListener("drop",g)}));let v,k=!1;o.addEventListener("click",(function(){void 0===v&&(0!=e.children.length?r.textContent="Please place all your ships first!":(document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",x))),v=!0,s.textContent="Your turn!",r.textContent="The game has started!"))}));let L=[],b=[];const E=[],C=[];function x(t){if(!k){if(t.target.classList.contains("taken")){t.target.classList.add("boom"),r.textContent="You hit the computer's ship!";let e=Array.from(t.target.classList);e=e.filter((t=>"block"!==t)),e=e.filter((t=>"boom"!==t)),e=e.filter((t=>"taken"!==t)),L.push(...e),S("player",L,E)}t.target.classList.contains("taken")||(r.textContent="Nothing hit!",t.target.classList.add("empty")),v=!1,document.querySelectorAll("#computer div").forEach((t=>t.replaceWith(t.cloneNode(!0)))),setTimeout(q,3e3)}}function q(){k||(s.textContent="Computers turn!",r.textContent="The computer is thinking",setTimeout((()=>{let t=Math.floor(Math.random()*a*a);const e=document.querySelectorAll("#player div");if(e[t].classList.contains("taken")&&e[t].classList.contains("boom"))q();else if(e[t].classList.contains("taken")&&!e[t].classList.contains("boom")){e[t].classList.add("boom"),r.textContent="The computer hit your ship!";let n=Array.from(e[t].classList);n=n.filter((t=>"block"!==t)),n=n.filter((t=>"boom"!==t)),n=n.filter((t=>"taken"!==t)),b.push(...n),S("computer",b,C)}else r.textContent="Nothing hit this time.",e[t].classList.add("empty")}),3e3),setTimeout((()=>{v=!0,s.textContent="Your Turn!",r.textContent="Plese make your turn.",document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",x)))}),6e3))}function S(t,e,n){function o(o,s){e.filter((t=>t===o)).length===s&&("player"===t&&(r.textContent=`You sunk the computer's ${o}.`,L=e.filter((t=>t!==o))),"computer"===t&&(r.textContent=`The computer sunk your ${o}.`,b=e.filter((t=>t!==o))),n.push(o))}o("destroyer",2),o("submarine",3),o("cruiser",3),o("battleship",4),o("carrier",5),5===E.length&&(r.textContent="You won!",k=!0),5===C.length&&(r.textContent="You lost!",k=!0)}})();