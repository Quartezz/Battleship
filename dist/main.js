(()=>{const t=document.querySelector("#flip-button"),e=document.querySelector(".option-container"),n=document.querySelector("#gamesboard-container"),o=document.querySelector("#start-button"),r=document.querySelector("#info"),s=document.querySelector("#turn-display"),c=document.querySelector("#shipsInfo");let a=0;t.addEventListener("click",(function(){const t=Array.from(e.children);a=0===a?90:0,t.forEach((t=>t.style.transform=`rotate(${a}deg)`))}));const i=10;function l(t,e){const o=document.createElement("div");o.classList.add("game-board"),o.style.backgroundColor=t,o.id=e;for(let t=0;t<i*i;t++){const e=document.createElement("div");e.classList.add("block"),e.id=t,o.append(e)}n.append(o)}l("#00bbf0","player"),l("#00bbf0","computer");class u{constructor(t,e){this.name=t,this.length=e}}const d=[new u("destroyer",2),new u("submarine",3),new u("cruiser",3),new u("battleship",4),new u("carrier",5)];let m,h;function f(t,e,n,o){let r,s=e?n<=i*i-o.length?n:i*i-o.length:n<=i*i-i*o.length?n:n-o.length*i+i,c=[];for(let n=0;n<o.length;n++)e?c.push(t[Number(s)+n]):c.push(t[Number(s)+n*i]);e?c.every(((t,e)=>r=c[0].id%i!=i-(c.length-(e+1)))):c.every(((t,e)=>r=c[0].id<i*e+1+90));const a=c.every((t=>!t.classList.contains("taken")));return{shipBlocks:c,valid:r,notTaken:a}}function p(t,e,n){const o=document.querySelectorAll(`#${t} div`);let r=Math.random()<.5,s="player"===t?0===a:r,c=Math.floor(Math.random()*i*i),l=n||c;const{shipBlocks:u,valid:d,notTaken:h}=f(o,s,l,e);d&&h?u.forEach((t=>{t.classList.add(e.name),t.classList.add("taken")})):("computer"===t&&p(t,e,n),"player"===t&&(m=!0))}function y(t){m=!1,h=t.target}function v(t){t.preventDefault();const e=d[h.id];!function(t,e){const n=document.querySelectorAll("#player div");let o=0===a;const{shipBlocks:r,valid:s,notTaken:c}=f(n,o,t,e);s&&c&&r.forEach((t=>{t.classList.add("hover"),setTimeout((()=>t.classList.remove("hover")),500)}))}(t.target.id,e)}function g(t){const e=t.target.id;p("player",d[h.id],e),m||h.remove()}d.forEach((t=>p("computer",t))),Array.from(e.children).forEach((t=>t.addEventListener("dragstart",y))),document.querySelectorAll("#player div").forEach((t=>{t.addEventListener("dragover",v),t.addEventListener("drop",g)}));let L,k=!1;o.addEventListener("click",(function(){void 0===L&&(0!=e.children.length?(r.textContent="Please place all your ships first!",s.textContent="Watch the info error!"):(c.classList.add("active"),document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",q))),L=!0,s.textContent="Your turn!",r.textContent="The game has started!"))}));let b=[],C=[];const E=[],x=[];function q(t){if(!k){if(t.target.classList.contains("taken")){t.target.classList.add("boom"),r.textContent="You hit the computer's ship!";let e=Array.from(t.target.classList);e=e.filter((t=>"block"!==t)),e=e.filter((t=>"boom"!==t)),e=e.filter((t=>"taken"!==t)),b.push(...e),T("player",b,E)}t.target.classList.contains("taken")||(r.textContent="Nothing hit!",t.target.classList.add("empty")),L=!1,document.querySelectorAll("#computer div").forEach((t=>t.replaceWith(t.cloneNode(!0)))),setTimeout(S,1500)}}function S(){k||(s.textContent="Computers turn!",r.textContent="The computer is thinking",setTimeout((()=>{let t=Math.floor(Math.random()*i*i);const e=document.querySelectorAll("#player div");if(e[t].classList.contains("taken")&&e[t].classList.contains("boom"))S();else if(e[t].classList.contains("taken")&&!e[t].classList.contains("boom")){e[t].classList.add("boom"),r.textContent="The computer hit your ship!";let n=Array.from(e[t].classList);n=n.filter((t=>"block"!==t)),n=n.filter((t=>"boom"!==t)),n=n.filter((t=>"taken"!==t)),C.push(...n),T("computer",C,x)}else r.textContent="Nothing hit this time.",e[t].classList.add("empty")}),1500),setTimeout((()=>{L=!0,s.textContent="Your Turn!",r.textContent="Plese make your turn.",document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",q)))}),3e3))}function T(t,e,n){function o(o,s){e.filter((t=>t===o)).length===s&&("player"===t&&(r.textContent=`You sunk the computer's ${o}.`,b=e.filter((t=>t!==o))),"computer"===t&&(r.textContent=`The computer sunk your ${o}.`,C=e.filter((t=>t!==o))),n.push(o))}o("destroyer",2),o("submarine",3),o("cruiser",3),o("battleship",4),o("carrier",5),5===E.length&&(r.textContent="You won!",k=!0),5===x.length&&(r.textContent="You lost!",k=!0)}})();